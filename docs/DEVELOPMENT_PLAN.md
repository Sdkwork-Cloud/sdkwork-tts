# Qwen3-TTS 剩余开发工作计划

**制定日期**: 2026 年 2 月 21 日  
**当前版本**: 1.2.0  
**目标版本**: 2.0.0 (生产就绪)

---

## 📋 剩余工作清单

### 高优先级 (生产就绪必需) - 预计 5-7 天

#### 1. Tokenizer 完整实现 (~500 行)

**当前状态**: RVQ 模块已完成 (421 行)

**剩余工作**:
- [ ] **音频特征提取** (~150 行)
  - [ ] Mel 频谱图计算
  - [ ] 16kHz/24kHz 重采样
  - [ ] 预加重滤波器
  
- [ ] **帧率处理** (~100 行)
  - [ ] 12.5 Hz 帧率转换
  - [ ] 帧对齐处理
  - [ ] 滑动窗口处理
  
- [ ] **WavLM 集成** (~150 行)
  - [ ] WavLM 特征提取
  - [ ] 语义特征投影
  - [ ] 语义 - 声学特征融合
  
- [ ] **端到端集成** (~100 行)
  - [ ] Encoder 接口
  - [ ] Decoder 接口
  - [ ] 完整编解码测试

**预计工作量**: 3-4 天  
**依赖**: 无  
**风险**: 低

#### 2. TalkerModel 参数验证 (~50 行)

**当前状态**: 需要参考 Qwen3 技术报告

**工作内容**:
- [ ] 查找 Qwen3 技术报告
- [ ] 确认准确层数
- [ ] 确认隐藏维度
- [ ] 确认注意力头数
- [ ] 更新配置参数

**预计工作量**: 1-2 天  
**依赖**: Qwen3 技术报告  
**风险**: 中 (参数可能不明确)

---

### 中优先级 (性能优化) - 预计 4-5 天

#### 3. FlashAttention 2 集成 (~100 行)

**当前状态**: 0%

**工作内容**:
- [ ] **依赖配置** (~20 行)
  - [ ] Cargo.toml 添加 candle-flash-attn
  - [ ] 条件编译配置
  
- [ ] **注意力实现** (~50 行)
  - [ ] FlashAttention 封装
  - [ ] 标准 Attention 回退
  - [ ] 自动检测支持
  
- [ ] **性能测试** (~30 行)
  - [ ] 基准测试
  - [ ] 性能对比
  - [ ] 文档更新

**预计工作量**: 2-3 天  
**依赖**: CUDA toolkit (可选)  
**风险**: 低

#### 4. 流式推理实现 (~300 行)

**当前状态**: 10% (架构就绪)

**工作内容**:
- [ ] **Dual-Track 架构** (~100 行)
  - [ ] 文本流处理
  - [ ] 音频流输出
  - [ ] 缓冲区管理
  
- [ ] **延迟优化** (~100 行)
  - [ ] 首包优化 (<100ms)
  - [ ] 增量生成
  - [ ] 并行处理
  
- [ ] **流式播放** (~100 行)
  - [ ] 音频流式播放
  - [ ] 回调接口
  - [ ] 错误处理

**预计工作量**: 3-4 天  
**依赖**: Tokenizer 完成  
**风险**: 中

---

### 低优先级 (功能增强) - 预计 2-3 天

#### 5. 完整 ECAPA-TDNN (~200 行)

**当前状态**: 简化版 (57 行)

**工作内容**:
- [ ] **TDNN 层** (~80 行)
  - [ ] 1D 卷积实现
  - [ ] 扩张卷积
  - [ ] BatchNorm
  
- [ ] **SE-ResNet 块** (~70 行)
  - [ ] 残差连接
  - [ ] SE 注意力
  - [ ] 通道加权
  
- [ ] **统计池化** (~50 行)
  - [ ] 均值池化
  - [ ] 标准差池化
  - [ ] 拼接输出

**预计工作量**: 2-3 天  
**依赖**: 无  
**风险**: 低

---

## 📅 开发时间表

### 第 1 周 (2026-02-21 ~ 2026-02-28)

**目标**: Tokenizer 完成 + 参数验证

| 日期 | 任务 | 交付物 |
|------|------|--------|
| 2/21 | RVQ 模块 | ✅ 已完成 |
| 2/22 | Mel 频谱图提取 | mel_spectrogram.rs |
| 2/23 | 帧率处理 | frame_processor.rs |
| 2/24 | WavLM 集成 | wavlm_features.rs |
| 2/25 | Tokenizer 集成 | tokenizer.rs |
| 2/26 | 参数验证 | config 更新 |
| 2/27 | 端到端测试 | tests.rs 更新 |
| 2/28 | 文档更新 | 文档完善 |

**里程碑**: Tokenizer 完整实现 ✅

### 第 2 周 (2026-02-28 ~ 2026-03-07)

**目标**: 性能优化

| 日期 | 任务 | 交付物 |
|------|------|--------|
| 3/01 | FlashAttention 配置 | Cargo.toml 更新 |
| 3/02 | FlashAttention 实现 | flash_attn.rs |
| 3/03 | 性能基准测试 | benches 更新 |
| 3/04 | Dual-Track 架构 | streaming.rs |
| 3/05 | 延迟优化 | latency_opt.rs |
| 3/06 | 流式播放 | audio_stream.rs |
| 3/07 | 流式测试 | tests.rs 更新 |

**里程碑**: 流式推理支持 ✅

### 第 3 周 (2026-03-07 ~ 2026-03-14)

**目标**: 功能增强 + 最终测试

| 日期 | 任务 | 交付物 |
|------|------|--------|
| 3/08 | TDNN 层实现 | tdnn.rs |
| 3/09 | SE-ResNet 块 | se_resnet.rs |
| 3/10 | 统计池化 | stats_pooling.rs |
| 3/11 | ECAPA-TDNN 集成 | speaker_encoder.rs 更新 |
| 3/12 | 完整测试套件 | tests.rs 完善 |
| 3/13 | 性能优化 | 性能调优 |
| 3/14 | 文档完善 | 所有文档更新 |

**里程碑**: ECAPA-TDNN 完整实现 ✅

---

## 📊 进度跟踪

### 总体进度

```
总工作量：~1,150 行代码
已完成：~2,920 行 (72%)
剩余：  ~1,150 行 (28%)
```

### 模块进度

| 模块 | 进度 | 状态 |
|------|------|------|
| Config | 100% | ✅ |
| KVCache | 100% | ✅ |
| Components | 100% | ✅ |
| TalkerModel | 90% | 🚧 参数待验证 |
| CodePredictor | 100% | ✅ |
| Decoder12Hz | 100% | ✅ |
| Generation | 100% | ✅ |
| SpeakerEncoder | 30% | 🚧 简化版 |
| RVQ | 100% | ✅ |
| Tokenizer | 60% | 🚧 RVQ 完成 |
| Streaming | 10% | 🚧 待开发 |

---

## 🎯 关键里程碑

### M1: Tokenizer 完成 (2026-02-28)

**验收标准**:
- [ ] Mel 频谱图提取正常工作
- [ ] 12.5 Hz 帧率处理正确
- [ ] WavLM 特征集成完成
- [ ] 端到端编解码测试通过
- [ ] 新增测试用例 ≥5 个

### M2: 流式推理支持 (2026-03-07)

**验收标准**:
- [ ] Dual-Track 架构实现
- [ ] 首包延迟 <150ms
- [ ] 流式播放正常工作
- [ ] 新增测试用例 ≥3 个
- [ ] 性能基准测试完成

### M3: 生产就绪 (2026-03-14)

**验收标准**:
- [ ] 所有高优先级任务完成
- [ ] 所有中优先级任务完成
- [ ] 测试覆盖率 ≥90%
- [ ] 文档完整
- [ ] 性能达标 (RTF <1.0)

---

## ⚠️ 风险管理

### 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| Qwen3 参数不明确 | 中 | 中 | 参考多个来源，合理推测 |
| WavLM 集成复杂 | 中 | 中 | 参考官方实现，简化处理 |
| 流式延迟不达标 | 低 | 高 | 预留优化时间，分阶段优化 |
| FlashAttention 兼容性问题 | 低 | 低 | 提供标准 Attention 回退 |

### 进度风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| Tokenizer 实现超时 | 中 | 中 | 优先实现核心功能 |
| 性能优化困难 | 低 | 中 | 分阶段优化，先功能后性能 |
| 测试用例不足 | 低 | 中 | 每周审查测试覆盖 |

---

## 📈 质量保证

### 代码质量

- [ ] 所有代码通过 `cargo fmt`
- [ ] 所有代码通过 `cargo clippy`
- [ ] 关键函数有文档注释
- [ ] 复杂逻辑有代码注释

### 测试质量

- [ ] 单元测试覆盖率 ≥85%
- [ ] 集成测试覆盖率 ≥80%
- [ ] 关键路径 100% 覆盖
- [ ] 所有测试通过

### 文档质量

- [ ] API 文档完整
- [ ] 使用示例完整
- [ ] 架构文档清晰
- [ ] 更新日志完整

---

## 📝 每日站会模板

```markdown
## 日期：YYYY-MM-DD

### 昨日完成
- [ ] 任务 1
- [ ] 任务 2

### 今日计划
- [ ] 任务 1
- [ ] 任务 2

### 遇到的问题
- [ ] 问题 1 (需要帮助)
- [ ] 问题 2 (已解决)

### 进度更新
- 总体进度：XX%
- 本周进度：XX%
```

---

## 🎉 完成奖励

### 版本 2.0.0 发布清单

- [ ] 生产就绪版本
- [ ] 完整文档
- [ ] 性能基准报告
- [ ] 使用示例
- [ ] 发布说明

---

**计划制定**: 2026-02-21  
**下次更新**: 2026-02-28  
**目标完成**: 2026-03-14
